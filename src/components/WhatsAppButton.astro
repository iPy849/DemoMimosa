---
import Icon from './icons/Icon.astro';
---

<!-- Floating WhatsApp: icon-only circle + tooltip after 60s -->
<div class="fixed bottom-6 right-6 z-50 flex flex-col items-end gap-3">
  <!-- Message bubble (hidden initially, shown after 60s) -->
  <div
    id="wa-bubble"
    class="opacity-0 translate-y-2 pointer-events-none transition-all duration-500 max-w-[220px] rounded-xl bg-[#fff] text-[#3A3837] px-4 py-3 text-sm font-body shadow-xl relative"
    role="status"
  >
    <span>En que podemos ayudarte?</span>
    <button
      id="wa-bubble-close"
      class="absolute -top-2 -right-2 w-5 h-5 rounded-full bg-[#e0e0e0] text-[#555] flex items-center justify-center text-xs leading-none hover:bg-[#ccc] cursor-pointer"
      aria-label="Close"
    >&times;</button>
    <!-- Tail pointing down-right toward the icon -->
    <div class="absolute -bottom-2 right-4 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[8px] border-t-[#fff]"></div>
  </div>

  <!-- Icon button -->
  <a
    href="https://wa.me/529981234567"
    target="_blank"
    rel="noopener noreferrer"
    id="wa-btn"
    class="flex items-center justify-center w-14 h-14 rounded-full bg-[#25D366] text-[#fff] shadow-2xl hover:scale-105 transition-transform"
    aria-label="WhatsApp"
  >
    <Icon name="whatsapp" class="w-7 h-7" id="wa-icon" />
  </a>
</div>

<script>
  const icon = document.getElementById('wa-icon');
  const bubble = document.getElementById('wa-bubble');
  const closeBtn = document.getElementById('wa-bubble-close');

  // Shake the icon every 5 seconds
  if (icon) {
    setInterval(() => {
      icon.classList.add('wa-shake');
      icon.addEventListener('animationend', () => {
        icon.classList.remove('wa-shake');
      }, { once: true });
    }, 5000);
  }

  // Show message bubble after 60 seconds
  if (bubble) {
    setTimeout(() => {
      bubble.classList.remove('opacity-0', 'translate-y-2', 'pointer-events-none');
      bubble.classList.add('opacity-100', 'translate-y-0');
    }, 60000);
  }

  // Close bubble on click
  if (closeBtn && bubble) {
    closeBtn.addEventListener('click', (e) => {
      e.preventDefault();
      bubble.classList.add('opacity-0', 'translate-y-2', 'pointer-events-none');
      bubble.classList.remove('opacity-100', 'translate-y-0');
    });
  }
</script>
