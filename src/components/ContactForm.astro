---
import Icon from './icons/Icon.astro';

interface Props {
  variant?: 'inline' | 'card';
}

const { variant = 'inline' } = Astro.props;
const isCard = variant === 'card';

const inputClass = "w-full bg-foreground/5 border border-foreground/15 rounded-md pl-11 pr-4 py-3 text-foreground font-body placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors";
const selectClass = "w-full bg-foreground/5 border border-foreground/15 rounded-md pl-11 pr-4 py-3 text-foreground font-body placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors appearance-none";
const textareaClass = "w-full bg-foreground/5 border border-foreground/15 rounded-md pl-11 pr-4 py-3 text-foreground font-body placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors resize-none";
---

<div class:list={["max-w-250 mx-auto", isCard && "bg-card rounded-lg border border-border p-8"]}>
  <form
    id="contact-form"
    class:list={[isCard ? "flex flex-col gap-6" : "max-w-2xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6"]}
  >
    <!-- Name -->
    <div class="flex flex-col gap-2">
      <label class="text-sm font-semibold font-body text-foreground">Nombre Completo</label>
      <div class="relative">
        <div class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none"><Icon name="user" class="w-5 h-5 text-muted-foreground/50" /></div>
        <input type="text" name="name" required class={inputClass} placeholder="Ingresa tu nombre completo" />
      </div>
    </div>

    {isCard ? (
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="flex flex-col gap-2">
          <label class="text-sm font-semibold font-body text-foreground">Correo Electronico</label>
          <div class="relative">
            <div class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none"><Icon name="mail" class="w-5 h-5 text-muted-foreground/50" /></div>
            <input type="email" name="email" required class={inputClass} placeholder="tucorreo@ejemplo.com" />
          </div>
        </div>
        <div class="flex flex-col gap-2">
          <label class="text-sm font-semibold font-body text-foreground">WhatsApp</label>
          <div class="relative">
            <div class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none"><Icon name="phone" class="w-5 h-5 text-muted-foreground/50" /></div>
            <input type="tel" name="whatsapp" class={inputClass} placeholder="+52 (998) 000 0000" />
          </div>
        </div>
      </div>
    ) : (
      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold font-body text-foreground">Correo Electronico</label>
        <div class="relative">
          <div class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none"><Icon name="mail" class="w-5 h-5 text-muted-foreground/50" /></div>
          <input type="email" name="email" required class={inputClass} placeholder="tucorreo@ejemplo.com" />
        </div>
      </div>
    )}

    {!isCard && (
      <div class="md:col-span-2 flex flex-col gap-2">
        <label class="text-sm font-semibold font-body text-foreground">Desarrollo de Interes</label>
        <div class="relative">
          <div class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none"><Icon name="home" class="w-5 h-5 text-muted-foreground/50" /></div>
          <select name="interest" class={selectClass}>
            <option value="" disabled selected>Selecciona un desarrollo</option>
            <option>Cuatro Bacalar</option>
            <option>Tulum Eco Resort</option>
            <option>Merida Heritage</option>
          </select>
          <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none"><Icon name="chevron-down" class="w-4 h-4 text-muted-foreground/50" /></div>
        </div>
      </div>
    )}

    <div class:list={["flex flex-col gap-2", !isCard && "md:col-span-2"]}>
      <label class="text-sm font-semibold font-body text-foreground">Mensaje</label>
      <div class="relative">
        <div class="absolute left-3 top-3.5 pointer-events-none"><Icon name="message-circle" class="w-5 h-5 text-muted-foreground/50" /></div>
        <textarea name="message" rows={isCard ? 5 : 4} class={textareaClass} placeholder="Cuentanos sobre tu proyecto de inversion..."></textarea>
      </div>
    </div>

    <div class:list={[!isCard && "md:col-span-2"]}>
      <button
        type="submit"
        id="contact-submit"
        class="w-full bg-primary text-primary-foreground px-8 py-4 text-xs tracking-[0.2em] font-bold font-body hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed rounded-md flex items-center justify-center gap-2"
      >
        <Icon name="send" class="w-4 h-4" />
        {isCard ? "ENVIAR MENSAJE" : "ENVIAR SOLICITUD"}
      </button>
    </div>

    <div id="form-message" class:list={["hidden text-sm font-body text-center py-3 rounded-md", !isCard && "md:col-span-2"]}></div>
  </form>
</div>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitBtn = document.getElementById('contact-submit') as HTMLButtonElement;
  const messageEl = document.getElementById('form-message') as HTMLDivElement;

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const originalHTML = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<svg class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg><span>...</span>';
      messageEl.classList.add('hidden');

      const formData = new FormData(form);
      const data = {
        name: formData.get('name'),
        email: formData.get('email'),
        whatsapp: formData.get('whatsapp'),
        interest: formData.get('interest'),
        message: formData.get('message'),
        timestamp: new Date().toISOString(),
      };

      console.log('[Contact Form Submission]', data);

      // Simulate success (in production, connect to email service or external API)
      await new Promise(resolve => setTimeout(resolve, 1000));

      messageEl.textContent = 'Su solicitud ha sido enviada exitosamente. Un asesor lo contactara pronto.';
      messageEl.classList.remove('hidden', 'text-red-500', 'bg-red-500/10');
      messageEl.classList.add('text-green-700', 'bg-green-500/10');
      form.reset();

      submitBtn.disabled = false;
      submitBtn.innerHTML = originalHTML;
    });
  }
</script>
