---
import PageLayout from '../../layouts/PageLayout.astro';
import ContactForm from '../../components/ContactForm.astro';
import { t } from '../../i18n/utils';
import { allDevelopments, developmentDetails } from '../../data/developments';

export function getStaticPaths() {
  return allDevelopments.map((dev) => ({ params: { id: dev.id } }));
}

const { id } = Astro.params;
const detail = developmentDetails[id!];
const dev = allDevelopments.find((d) => d.id === id);

if (!dev) return Astro.redirect('/developments');
---

<PageLayout title={`${dev.title} | MIMOSA Developments`}>
  <section class="pt-32 pb-24 px-6">
    <div class="max-w-7xl mx-auto">
      <a href="/developments" class="inline-flex items-center gap-2 text-primary text-sm tracking-wider uppercase font-bold font-body hover:underline mb-8">
        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
        <span data-t="dev.back">{t("dev.back")}</span>
      </a>

      <h1 class="text-4xl md:text-5xl font-headline font-bold text-foreground mb-4">{dev.title}</h1>
      <div class="flex items-center gap-2 text-primary mb-8">
        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
        <span class="font-body">{dev.location}</span>
      </div>

      {detail ? (
        <>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-12">
            {detail.images.map((img, i) => (
              <div class:list={["rounded-lg overflow-hidden", i === 0 && "md:col-span-2 aspect-[2/1]", i > 0 && "aspect-[4/3]"]}>
                <img src={img} alt={`${dev.title} - ${i + 1}`} class="w-full h-full object-cover" loading={i === 0 ? "eager" : "lazy"} />
              </div>
            ))}
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 mb-16">
            <div class="lg:col-span-2">
              <p class="text-lg text-muted-foreground leading-relaxed font-body">{detail.description.es}</p>
            </div>
            <div class="bg-card rounded-lg border border-border p-6">
              <h3 class="font-headline font-semibold text-foreground mb-4">Amenidades</h3>
              <ul class="flex flex-col gap-3">
                {detail.amenities.es.map((amenity) => (
                  <li class="flex items-center gap-2 text-muted-foreground font-body text-sm">
                    <svg class="w-4 h-4 text-primary shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                    {amenity}
                  </li>
                ))}
              </ul>
            </div>
          </div>

          {detail.mapUrl && (
            <div class="mb-16">
              <h3 class="text-2xl font-headline font-semibold text-foreground mb-6" data-t="dev.location">{t("dev.location")}</h3>
              <div class="rounded-lg overflow-hidden border border-border aspect-[2/1]">
                <iframe src={detail.mapUrl} width="100%" height="100%" style="border:0;" allowfullscreen loading="lazy" referrerpolicy="no-referrer-when-downgrade" title={`Map - ${dev.title}`}></iframe>
              </div>
            </div>
          )}
        </>
      ) : (
        <div class="text-center py-16">
          <p class="text-muted-foreground font-body text-lg">{dev.description.es}</p>
          <div class="relative aspect-[2/1] rounded-lg overflow-hidden mt-8">
            <img src={dev.image} alt={dev.title} class="w-full h-full object-cover" />
          </div>
        </div>
      )}

      <div class="mt-16">
        <h3 class="text-2xl font-headline font-semibold text-foreground mb-8 text-center" data-t="contact.title">{t("contact.title")}</h3>
        <ContactForm variant="card" />
      </div>
    </div>
  </section>
</PageLayout>
