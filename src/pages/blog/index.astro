---
import PageLayout from '../../layouts/PageLayout.astro';
import { useTranslations, localePath, type Language } from '../../i18n/utils';
import { getCollection } from 'astro:content';

const lang: Language = 'es';
const t = useTranslations(lang);

const allPosts = await getCollection('blog', ({ data }) => data.lang === lang);
const posts = allPosts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
---

<PageLayout lang={lang} title="Blog | MIMOSA Developments">
  <section class="pt-32 pb-24 px-6">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <p class="text-primary text-sm tracking-[0.3em] uppercase mb-2 font-body">{t("blog.subtitle")}</p>
        <h1 class="text-4xl md:text-5xl font-headline font-bold text-foreground">{t("blog.title")}</h1>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">
        {posts.map((post) => (
          <a href={localePath(lang, `/blog/${post.id}`)} class="group block">
            <article class="bg-card rounded-lg overflow-hidden border border-border hover:shadow-lg transition-all duration-300 group-hover:-translate-y-1">
              <div class="relative aspect-[16/10] overflow-hidden">
                <img src={post.data.image} alt={post.data.title} class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" loading="lazy" />
              </div>
              <div class="p-6">
                <div class="flex items-center gap-4 text-sm text-muted-foreground mb-3 font-body">
                  <span class="flex items-center gap-1">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>
                    {post.data.date}
                  </span>
                  <span class="flex items-center gap-1">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    {post.data.author}
                  </span>
                </div>
                <h2 class="text-xl font-headline font-semibold mb-2 text-foreground group-hover:text-primary transition-colors">{post.data.title}</h2>
                <p class="text-muted-foreground font-body text-sm leading-relaxed mb-4">{post.data.excerpt}</p>
                <span class="text-primary text-sm font-bold tracking-wider uppercase font-body inline-flex items-center gap-2 group-hover:gap-3 transition-all">
                  {t("blog.read_more")}
                  <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                </span>
              </div>
            </article>
          </a>
        ))}
      </div>
    </div>
  </section>
</PageLayout>
